<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Play Chess vs AI</title>
  <style>
    body {
      background-color: #1a1a2e;
      color: #f8f8f2;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 20px;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 60px);
      grid-template-rows: repeat(8, 60px);
      margin-top: 30px;
      border: 4px solid white;
    }

    .square {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      cursor: pointer;
    }

    .white { background-color: #e0e0e0; }
    .black { background-color: #505050; }
    .selected { outline: 3px solid yellow; }

    #status {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>Play Chess vs AI</h1>
  <div id="board"></div>
  <div id="status">Your turn (white)</div>

  <script>
    const boardDiv = document.getElementById('board');
    const statusDiv = document.getElementById('status');
    let selected = null;
    let currentFEN = "";

    const pieceUnicode = {
      p: '♟', r: '♜', n: '♞', b: '♝', q: '♛', k: '♚',
      P: '♙', R: '♖', N: '♘', B: '♗', Q: '♕', K: '♔'
    };

    function fetchBoard() {
      fetch('/board')
        .then(res => res.json())
        .then(data => {
          drawBoard(data.fen);
          if (data.is_checkmate) {
            statusDiv.textContent = `Checkmate! Winner: ${data.winner}`;
          } else if (data.is_check) {
            statusDiv.textContent = `${data.turn} is in check`;
          } else {
            statusDiv.textContent = `${data.turn}'s turn`;
          }
        });
    }

    function drawBoard(fen) {
      currentFEN = fen;
      boardDiv.innerHTML = '';
      const rows = fen.split(' ')[0].split('/');
      for (let i = 0; i < 8; i++) {
        let row = rows[i];
        let colIndex = 0;
        for (const char of row) {
          if (!isNaN(char)) {
            for (let j = 0; j < parseInt(char); j++) {
              addSquare(i, colIndex++, '');
            }
          } else {
            addSquare(i, colIndex++, pieceUnicode[char] || '');
          }
        }
      }
    }

    function addSquare(row, col, piece) {
      const square = document.createElement('div');
      const isWhite = (row + col) % 2 === 0;
      square.className = `square ${isWhite ? 'white' : 'black'}`;
      square.dataset.row = row;
      square.dataset.col = col;
      square.textContent = piece;
      square.onclick = () => handleClick(row, col);
      boardDiv.appendChild(square);
    }

    function algebraic(row, col) {
      return 'abcdefgh'[col] + (8 - row);
    }

    function handleClick(row, col) {
      const square = document.querySelector(`[data-row='${row}'][data-col='${col}']`);
      if (selected) {
        const [fromRow, fromCol] = selected;
        move(algebraic(fromRow, fromCol), algebraic(row, col));
        selected = null;
      } else {
        selected = [row, col];
        square.classList.add('selected');
      }
    }

    function move(from, to) {
      fetch('/move', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ from_square: from, to_square: to })
      })
      .then(res => res.json())
      .then(() => fetchBoard());
    }

    fetchBoard();
  </script>
</body>
</html>


</body>
</html>


