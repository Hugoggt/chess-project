<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Échiquier</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css" />
  <style>
    body {
      background-color: #0b1a2b; /* bleu nuit */
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      font-family: Arial, sans-serif;
    }
    #board {
      width: 400px;
      margin-top: 50px;
    }
    #status {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Échiquier</h1>
  <div id="board"></div>
  <div id="status">Votre tour (blancs)</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
  <script>
    const boardDiv = document.getElementById('board');
    const statusDiv = document.getElementById('status');
    let board = null;
    let game = new Chess();

    function updateStatus(response) {
      if (response.is_game_over) {
        statusDiv.innerText = "Partie terminée - Résultat : " + response.result;
      } else {
        statusDiv.innerText = "Votre tour (blancs)";
      }
      board.position(response.fen);
    }

    function makeMove(source, target) {
      const move = source + target;
      fetch('/move', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ uci: move })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          alert("Coup invalide : " + data.error);
          return;
        }
        updateStatus(data);
      });
    }

    fetch('/board')
      .then(res => res.json())
      .then(data => {
        game.load(data.fen);
        board = Chessboard('board', {
          draggable: true,
          position: data.fen,
          onDrop: function (source, target) {
            makeMove(source, target);
          }
        });
        updateStatus(data);
      });
  </script>
</body>
</html>

