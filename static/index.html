<!DOCTYPE html>
<html>
<head>
  <title>Python Chess</title>
  <style>
    body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #ddd; }
    #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); }
    .cell {
      width: 60px; height: 60px; display: flex; justify-content: center; align-items: center;
      font-size: 32px; font-weight: bold; cursor: pointer;
    }
    .white { background: #f0d9b5; }
    .black { background: #b58863; }
    .selected { outline: 3px solid red; }
  </style>
</head>
<body>
  <div>
    <div id="board"></div>
    <button onclick="restart()">Restart</button>
  </div>

  <script>
    let selected = null;

    async function getBoard() {
      const res = await fetch('/board');
      const data = await res.json();
      drawBoard(data.board);
    }

    function drawBoard(board) {
      const boardDiv = document.getElementById('board');
      boardDiv.innerHTML = '';
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell ' + ((x + y) % 2 === 0 ? 'white' : 'black');
          cell.textContent = board[y][x];
          cell.dataset.x = x;
          cell.dataset.y = y;
          cell.onclick = () => cellClicked(x, y);
          boardDiv.appendChild(cell);
        }
      }
    }

    async function cellClicked(x, y) {
      if (!selected) {
        selected = {x, y};
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
        document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`).classList.add('selected');
      } else {
        const move = {
          from_x: selected.x,
          from_y: selected.y,
          to_x: x,
          to_y: y
        };
        await fetch('/move', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(move)
        });
        selected = null;
        getBoard();
      }
    }

    async function restart() {
      await fetch('/restart', { method: 'POST' });
      getBoard();
    }

    getBoard();
  </script>
</body>
</html>


